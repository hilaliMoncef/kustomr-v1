{% extends 'main/layout.html' %}

{% block content %}
{% load static %}

<div class="divider">
    <div class="hr"></div>
    <div class="text">Retrouvez vos clients ci-dessous :</div>
    <div class="hr"></div>
    <div class="dropdown">
        <button class="btn btn-sm btn-outline-primary ml-3 dropdown-toggle" type="button" id="exportLinks"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-file-export"></i> Exporter
        </button>

        <div class="dropdown-menu dropdown-menu-right" id="exportLinksDropdown" aria-labelledby="exportLinks">

        </div>
    </div>
</div>

<div class="row">
    <div class="col-12 mb-3">
        <div class="card position-relative">
            <div class="card-float bottom right">
                <a href="" class="btn-round btn-primary">
                    <i class="fas fa-user-plus"></i>
                </a>
            </div>
            <div class="card-header">
                <span class="title text-uppercase">Listing clients</span>
            </div>
            <div class="card-body">
                <table class="table w-100" id="customer_listing">
                    <thead>
                        <tr>
                            <th scope="col">Utilisateurs</th>
                            <th scope="col">Téléphone</th>
                            <th scope="col">Numéro clients</th>
                            <th scope="col">Points accumulés</th>
                            <th scope="col">Date</th>
                            <th scope="col">Status</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for customer in customers %}
                        <tr>
                            <td>{{ customer.user }}</td>
                            <td>{{ customer.user.phone }}</td>
                            <td>#{{ customer.id }}</td>
                            <td>{{ customer.points }} point{% if customer.points > 1 %}s{% endif %}</td>
                            <td>{{ customer.user.date_joined }}</td>
                            <td>
                                {% if customer.user.is_active %}
                                <span class="badge badge-success">Actif</span>
                                {% else %}
                                <span class="badge badge-danger">Inactif</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="" class="text-primary" id="toggleRightbar"
                                    data-target="data-{{ customer.pk }}">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block rightbar %}
<div class="container">
    {% for customer in customers %}
    <div id="data-{{ customer.pk }}" class="d-none py-4 px-4">
        <div class="row d-flex align-items-center justify-content-between">
            <a href="" class="text-primary" id="closeRightbar" data-target="data-{{ customer.pk }}">
                < Retour</a>
                    <a href="" class="text-muted"><i class="fas fa-info-circle"></i></a>
        </div>

        <div class="row d-flex align-items-stretch justify-content-between">
            <div class="d-flex flex-column">
                <h3 class="text-primary mb-2 font-weight-bold">{{ customer.user }}</h3>
                <span><i class="fas fa-envelope my-2 text-primary"></i> {{ customer.user.email }}</span>
                <span><i class="fas fa-phone mt-2 text-primary"></i> {{ customer.user.phone }}</span>
            </div>

            <button type="button"
                class="btn btn-primary d-flex flex-column align-items-center rounded justify-content-center">
                <i class="fas fa-2x fa-hand-holding-usd"></i>
                <span class="text-uppercase font-weight-bold">Encaisser</span>
            </button>
        </div>

        <div class="row">
            <div class="col card card-outline-primary mr-2">
                <span class="h3 text-primary font-weight-bold mb-1">{{ customer.points }}</span>
                <span>Points cumulés</span>
            </div>
            <div class="col card card-outline card-outline-primary">
                <span class="h3 text-primary font-weight-bold mb-1">680€</span>
                <span>Dépenses réalisées</span>
            </div>
        </div>

        <div class="row">
            <div class="card card-outline w-100">
                <div class="w-100 text-center font-weight-bold mb-3">
                    Dernières activités
                </div>
                <div class="timeline-wrapper">
                    <div class="timeline">
                        <ul>
                            <li>
                                <span class="dot"></span>
                                <span>15 avril 2020 à 12h53</span>
                                <span>56 points</span>
                            </li>
                            <li>
                                <span class="dot"></span>
                                <span>15 avril 2020 à 12h53</span>
                                <span>56 points</span>
                            </li>
                            <li>
                                <span class="dot"></span>
                                <span>15 avril 2020 à 12h53</span>
                                <span>56 points</span>
                            </li>
                            <li>
                                <span class="dot"></span>
                                <span>15 avril 2020 à 12h53</span>
                                <span>56 points</span>
                            </li>
                        </ul>
                    </div>
                </div>

            </div>
            {% endfor %}
        </div>

        <div class="row">
            <ul class="metrics list-unstyled">
                <li>
                    <span>Panier moyen</span>
                    <span class="text-primary font-weight-bold">36,65€</span>
                </li>
                <li>
                    <span>Fréquence des visites</span>
                    <span class="text-primary font-weight-bold">3 fois / mois</span>
                </li>
                <li>
                    <span>Taux d'engagement</span>
                    <span class="text-primary font-weight-bold">5</span>
                </li>
                <li>
                    <span>Dernière visite</span>
                    <span class="text-primary font-weight-bold">15 Avril 2020</span>
                </li>
                <li>
                    <span>Point de vente favoris</span>
                    <span class="text-primary font-weight-bold">Paris 17ème</span>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="w-100 d-flex align-items-center">
    <button type="button" class="btn btn-primary btn-list border-right flex-grow-1"><i class="fas fa-envelope mr-2"></i> Envoyer un mail</button>
    <button type="button" class="btn btn-primary btn-list flex-grow-1"><i class="fas fa-comment mr-2"></i> Envoyer un SMS</button>
</div>
{% endblock %}

{% block script %}
<script>
    $(document).ready(function () {
        var table = $('#customer_listing').DataTable({
            paging: true,
            ordering: true,
            searching: true,
            responsive: true,
            columns: [
                { "orderable": true },
                { "orderable": true },
                { "orderable": true },
                { "orderable": true },
                { "orderable": true },
                { "orderable": true },
                { "orderable": false }
            ],
            buttons: {
                dom: {
                    container: {
                        tag: 'div'
                    },
                    button: {
                        tag: 'a',
                        className: 'dropdown-item',
                    }
                },
                buttons: [
                    {
                        extend: 'copy',
                        text: 'Copier',
                        className: 'dropdown-item',
                        tag: 'a'
                    },
                    {
                        extend: 'excel',
                        text: 'Excel',
                        className: 'dropdown-item',
                        tag: 'a'
                    },
                    {
                        extend: 'pdf',
                        text: 'PDF',
                        className: 'dropdown-item',
                        tag: 'a'
                    }
                ]
            },
            language: {
                "decimal": "",
                "emptyTable": "Aucune donnée disponible",
                "info": "_START_ à _END_ entrées visibles sur _TOTAL_",
                "infoEmpty": "0 à 0 entrées visibles sur 0",
                "infoFiltered": "(filtrés d'un total de _MAX_ entrées)",
                "infoPostFix": "",
                "thousands": " ",
                "lengthMenu": "Voir _MENU_ entrées",
                "loadingRecords": "Chargement...",
                "processing": "Traitement...",
                "search": "Rechercher:",
                "zeroRecords": "Aucune correspondance trouvée.",
                "paginate": {
                    "first": "Premier",
                    "last": "Dernier",
                    "next": "Suivant",
                    "previous": "Précédent"
                },
                "aria": {
                    "sortAscending": ": activer pour trier la colonne dans l'ordre ascendant",
                    "sortDescending": ": activer pour trier la colonne dans l'ordre descendant"
                }
            }
        });


        $('#exportLinksDropdown').append(table.buttons().container());
        console.log(table.buttons().container()[0])
        //table.buttons().container().appendTo( $('#exportLinksDropdown', table.table().container() ) );
    });
</script>
{% endblock %}